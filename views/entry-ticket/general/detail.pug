//- ========================================
//- VIEWS/ENTRY-TICKET/GENERAL/DETAIL.PUG - CON BOTÓN DE ARCHIVOS
//- ========================================

extends ../../layouts/main

block content
  .min-h-screen.bg-gray-50
    //- Header
    header.bg-white.shadow-sm
      div(class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8")
        .flex.justify-between.items-center.py-6
          .flex.items-center.space-x-4
            a(href="/entry-ticket/general/history" class="text-pink-600 hover:text-pink-800 transition-colors")
              svg.h-6.w-6(fill="none" stroke="currentColor" viewBox="0 0 24 24")
                path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18")
            
            div
              h1.text-2xl.font-bold.text-gray-900 Vale de Entrada ##{vale.id_vale_de_entrada}
              .text-sm.text-gray-600 Almacén General
          
          .flex.space-x-3
            //- ✅ BOTÓN DE ARCHIVOS - NUEVO
            a(
              href=`/archivos-vale-entrada/vale/${vale.id_vale_de_entrada}`
              class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition duration-200 print:hidden flex items-center"
              title="Gestionar archivos del vale"
            )
              svg.w-4.h-4.mr-2(fill="none" stroke="currentColor" viewBox="0 0 24 24")
                path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13")
              | Archivos
              if archivos_info && archivos_info.total_archivos > 0
                span.ml-1.inline-flex.items-center.justify-center.px-2.py-1.rounded-full.text-xs.font-bold.bg-white.text-blue-600= archivos_info.total_archivos

            button(
              onclick="window.print()" 
              class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm font-medium transition duration-200 print:hidden"
            )
              svg.w-4.h-4.inline.mr-2(fill="none" stroke="currentColor" viewBox="0 0 24 24")
                path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z")
              | Imprimir

    div(class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6")
      //- Grid principal reorganizado: Proveedor, Info General, Sistema, Totales
      div(class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6")

        //- 1. Información del proveedor
        .bg-white.rounded-lg.shadow-sm.overflow-hidden
          div(class="bg-[#007867] px-4 py-3")
            h3.text-base.font-medium.text-white.flex.items-center
              | Proveedor

          .p-4
            if vale.proveedor
              .space-y-3
                div
                  .text-xs.font-medium.text-gray-500.uppercase.tracking-wide Nombre
                  .text-sm.font-bold.text-gray-900= vale.proveedor
                
                if vale.proveedor_rfc
                  div
                    .text-xs.font-medium.text-gray-500.uppercase.tracking-wide RFC
                    .text-sm.font-mono.font-bold.text-gray-900= vale.proveedor_rfc
                
                if vale.proveedor_domicilio
                  div
                    .text-xs.font-medium.text-gray-500.uppercase.tracking-wide Domicilio
                    .text-xs.font-bold.text-gray-900= vale.proveedor_domicilio
                
                if vale.proveedor_telefono
                  div
                    .text-xs.font-medium.text-gray-500.uppercase.tracking-wide Teléfono
                    .text-sm.font-bold.text-gray-900= vale.proveedor_telefono
                
                if vale.repartidor
                  div
                    .text-xs.font-medium.text-gray-500.uppercase.tracking-wide Repartidor
                    .text-sm.font-bold.text-gray-900= vale.repartidor
            else
              .text-center.py-4
                svg.mx-auto.h-8.w-8.text-gray-300.mb-2(fill="none" stroke="currentColor" viewBox="0 0 24 24")
                  path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z")
                .text-xs.text-gray-500 Sin información

        //- 2. Información general
        .bg-white.rounded-lg.shadow-sm.overflow-hidden
          div(class="bg-[#007867] px-4 py-3")
            h3.text-base.font-medium.text-white.flex.items-center
              | Información General

          .p-4.space-y-3
            div
              .text-xs.font-medium.text-gray-500.uppercase.tracking-wide Fecha de Entrada
              .text-sm.font-bold.text-gray-900= new Date(vale.fecha_de_entrada).toLocaleDateString('es-MX', { year: 'numeric', month: 'long', day: 'numeric' })
            
            div
              .text-xs.font-medium.text-gray-500.uppercase.tracking-wide Número de Factura
              .text-sm.font-bold.text-gray-900= vale.numero_de_factura || 'Sin número'
            
            div
              .text-xs.font-medium.text-gray-500.uppercase.tracking-wide Requisición
              .text-sm.font-bold.text-gray-900= vale.requisicion_de_entrada || 'N/A'
            
            if vale.fecha_de_emision_factura
              div
                .text-xs.font-medium.text-gray-500.uppercase.tracking-wide Emisión Factura
                .text-sm.font-bold.text-gray-900= new Date(vale.fecha_de_emision_factura).toLocaleDateString('es-MX')
            
            if vale.tipo_de_compra
              div
                .text-xs.font-medium.text-gray-500.uppercase.tracking-wide Tipo de Compra
                .text-sm.font-bold.text-gray-900= vale.tipo_de_compra

        //- 3. Sistema
        .bg-white.rounded-lg.shadow-sm.overflow-hidden
          div(class="bg-[#007867] px-4 py-3")
            h3.text-base.font-medium.text-white.flex.items-center
              | Sistema

          .p-4.space-y-3
            div
              .text-xs.font-medium.text-gray-500.uppercase.tracking-wide Estatus
              span.inline-flex.items-center.px-2.py-1.rounded.text-xs.font-bold.bg-gray-100.text-gray-900= vale.estatus_de_captura || 'N/A'
            
            div
              .text-xs.font-medium.text-gray-500.uppercase.tracking-wide Capturado por
              .text-sm.font-bold.text-gray-900= vale.empleado_completo || 'No especificado'
            
            if vale.partida
              div
                .text-xs.font-medium.text-gray-500.uppercase.tracking-wide Partida
                .text-xs.font-mono.font-bold.text-black-800.px-2.py-1.rounded= vale.clave_objeto_del_gasto
                .text-sm.font-bold.text-gray-900.mt-1= vale.partida

        //- 4. Totales
        .bg-white.rounded-lg.shadow-sm.overflow-hidden
          div(class="bg-[#007867] px-4 py-3")
            h3.text-base.font-medium.text-white.flex.items-center
              | Totales

          .p-4.space-y-3
            .flex.justify-between.items-center
              span.text-xs.font-medium.text-gray-500.uppercase.tracking-wide Subtotal:
              span.text-sm.font-medium.text-gray-900 $#{parseFloat(vale.subtotal || 0).toLocaleString('es-MX', {minimumFractionDigits: 2})}
            
            .flex.justify-between.items-center
              span.text-xs.font-medium.text-gray-500.uppercase.tracking-wide IVA:
              span.text-sm.font-medium.text-gray-900 $#{parseFloat(vale.iva || 0).toLocaleString('es-MX', {minimumFractionDigits: 2})}
            
            .border-t.pt-3
              .flex.justify-between.items-center
                span.text-sm.font-medium.text-gray-900 Total:
                span.text-xl.font-bold.text-gray-900 $#{parseFloat(vale.total || 0).toLocaleString('es-MX', {minimumFractionDigits: 2})}

      

      //- Observaciones (si existen)
      if vale.observaciones
        .bg-white.rounded-lg.shadow-sm.overflow-hidden.mb-6
          div(class="bg-[#007867] px-4 py-3")
            h3.text-base.font-medium.text-white.flex.items-center
              | Observaciones
          .p-4
            .text-sm.text-gray-700= vale.observaciones

      //- Detalle de productos
      .bg-white.rounded-lg.shadow-sm.overflow-hidden
        div(class="bg-[#007867] px-4 py-3")
          h3.text-base.font-medium.text-white.flex.items-center
            | Detalle de Productos

        .overflow-x-auto
          table.min-w-full.divide-y.divide-gray-200
            thead.bg-gray-50
              tr
                th.px-4.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase.tracking-wider #
                th.px-4.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase.tracking-wider Producto
                th.px-4.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase.tracking-wider Código
                th.px-4.py-3.text-center.text-xs.font-medium.text-gray-500.uppercase.tracking-wider Cantidad
                th.px-4.py-3.text-center.text-xs.font-medium.text-gray-500.uppercase.tracking-wider Unidad
                th.px-4.py-3.text-right.text-xs.font-medium.text-gray-500.uppercase.tracking-wider Precio Unit.
                th.px-4.py-3.text-right.text-xs.font-medium.text-gray-500.uppercase.tracking-wider Importe
                th.px-4.py-3.text-center.text-xs.font-medium.text-gray-500.uppercase.tracking-wider Caducidad
                th.px-4.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase.tracking-wider Nota

            tbody.bg-white.divide-y.divide-gray-200
              if detalle && detalle.length > 0
                each producto, index in detalle
                  tr(class="hover:bg-gray-50 transition-colors")
                    td.px-4.py-3.whitespace-nowrap.text-sm.font-medium.text-gray-900.text-center= index + 1
                    td.px-4.py-3.whitespace-nowrap.text-sm.text-gray-900= producto.producto_generico
                    td.px-4.py-3.whitespace-nowrap
                      span.inline-flex.items-center.px-2.py-1.rounded.text-xs.font-medium.bg-gray-100.text-gray-800= producto.codigo
                    td.px-4.py-3.whitespace-nowrap.text-sm.text-gray-900.text-center= parseFloat(producto.cantidad).toLocaleString('es-MX')
                    td.px-4.py-3.whitespace-nowrap.text-sm.text-gray-900.text-center= producto.abreviatura
                    td.px-4.py-3.whitespace-nowrap.text-sm.text-gray-900.text-right $#{parseFloat(producto.precio_unitario).toLocaleString('es-MX', {minimumFractionDigits: 2})}
                    td.px-4.py-3.whitespace-nowrap.text-sm.font-medium.text-gray-900.text-right $#{parseFloat(producto.importe).toLocaleString('es-MX', {minimumFractionDigits: 2})}
                    td.px-4.py-3.whitespace-nowrap.text-center
                      if producto.fecha_de_caducidad
                        span.inline-flex.items-center.px-2.py-1.rounded.text-xs.font-medium.text-black-800= new Date(producto.fecha_de_caducidad).toLocaleDateString('es-MX')
                      else
                        span.text-gray-400.text-xs N/A
                    td.px-4.py-3.text-sm.text-gray-700
                      if producto.nota
                        = producto.nota
                      else
                        span.text-gray-400.text-xs Sin nota
              else
                tr
                  td.px-4.py-8.text-center.text-gray-500(colspan="9")
                    svg.mx-auto.h-8.w-8.text-gray-300.mb-2(fill="none" stroke="currentColor" viewBox="0 0 24 24")
                      path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4")
                    .text-sm.font-medium.text-gray-900 No hay productos registrados
                    .text-xs.text-gray-500 Este vale no tiene productos asociados.

block styles
  style.
    @media print {
      .print\\:hidden {
        display: none !important;
      }
      .shadow-sm {
        box-shadow: none !important;
      }
      .bg-gray-800 {
        background: #374151 !important;
        color: white !important;
      }
      body {
        font-size: 12px;
      }
      .rounded-lg {
        border-radius: 0 !important;
      }
    }
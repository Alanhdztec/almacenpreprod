//- ========================================
//- VIEWS/INVENTORY/OFICIALIA/ACCIONES.PUG - ACCIONES DE INVENTARIO PARA JEFE DE ALMACÉN
//- ========================================

extends ../../layouts/main

block content
  .min-h-screen.bg-gray-50
    //- Header específico para acciones de inventario
    header.bg-white.shadow
      div(class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8")
        .flex.justify-between.items-center.py-6
          .flex.items-center
            button.menu-toggle(
              type="button" 
              id="sidebarToggle"
              class="mr-3 p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition duration-150 ease-in-out"
              title="Abrir menú"
            )
              svg.h-6.w-6(fill="none", stroke="currentColor", viewBox="0 0 24 24")
                path(stroke-linecap="round", stroke-linejoin="round", stroke-width="2", d="M4 6h16M4 12h16M4 18h16")
            
            //- Icono específico para acciones de inventario
            svg.h-8.w-8.text-indigo-600.mr-3(fill="currentColor", viewBox="0 0 20 20")
              path(fill-rule="evenodd", d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z", clip-rule="evenodd")
            
            h1.text-2xl.font-bold.text-gray-900 Acciones de Inventario
            span.ml-2.text-sm.text-gray-500.bg-indigo-100.px-2.py-1.rounded-full Jefe de Almacén
            
          .flex.items-center.space-x-4
            .text-sm.text-gray-700
              span.font-medium #{user.nombres}
            
            form(action="/auth/logout", method="POST", style="display: inline;")
              button(
                type="submit"
                title="Cerrar sesión"
                class="bg-pink-600 hover:bg-pink-700 text-white p-2 rounded-md transition duration-150 ease-in-out"
              )
                svg(xmlns="http://www.w3.org/2000/svg", fill="none", viewBox="0 0 24 24", stroke-width="1.5", stroke="currentColor", class="w-5 h-5")
                  path(stroke-linecap="round", stroke-linejoin="round", d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9")
                  
    //- Overlay para cerrar sidebar en móvil
    div(id="sidebarOverlay" class="fixed inset-0 bg-transparent z-40 hidden lg:hidden")

    //- Sidebar
    aside(id="sidebar" class="fixed inset-y-0 left-0 z-50 w-80 bg-white shadow-lg transform -translate-x-full transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:inset-0 lg:z-auto lg:shadow-none lg:w-80")
      .flex.flex-col.h-full
        
        //- Header del sidebar
        .flex.items-center.justify-between.px-6.py-4.bg-gray-50.border-b.border-gray-200
          .flex.items-center
            svg.h-6.w-6.text-indigo-600.mr-2(fill="currentColor", viewBox="0 0 20 20")
              path(fill-rule="evenodd", d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z", clip-rule="evenodd")
            h2.text-lg.font-semibold.text-gray-900 Menú Principal
          
          //- Botón cerrar (solo visible en móvil)
          button(id="closeSidebar" class="lg:hidden p-1 rounded-md text-gray-400 hover:text-gray-600 hover:bg-gray-100")
            svg.h-6.w-6(fill="none", stroke="currentColor", viewBox="0 0 24 24")
              path(stroke-linecap="round", stroke-linejoin="round", stroke-width="2", d="M6 18L18 6M6 6l12 12")
        
        //- Navegación del sidebar
        nav.flex-1.px-4.py-4.space-y-2.overflow-y-auto
          
          //- Sección: Vales de Entrada
          .space-y-1
            .px-2.py-1.text-xs.font-semibold.text-gray-500.uppercase.tracking-wide
              | Vales de Entrada
            
            a.sidebar-link(
              href="/entry-ticket/oficialia/history"
              class="flex items-center px-3 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 hover:text-gray-900 transition duration-150 ease-in-out"
            )
              svg.h-5.w-5.mr-3.text-gray-400(fill="none", stroke="currentColor", viewBox="0 0 24 24")
                path(stroke-linecap="round", stroke-linejoin="round", stroke-width="2", d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z")
              | Historial de Vales de Entrada
          
          //- Divisor
          .border-t.border-gray-200.my-4
          
          //- Sección: Vales de Salida
          .space-y-1
            .px-2.py-1.text-xs.font-semibold.text-gray-500.uppercase.tracking-wide
              | Vales de Salida
            
            a.sidebar-link(
              href="/exit-ticket/oficialia/history"
              class="flex items-center px-3 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 hover:text-gray-900 transition duration-150 ease-in-out"
            )
              svg.h-5.w-5.mr-3.text-gray-400(fill="none", stroke="currentColor", viewBox="0 0 24 24")
                path(stroke-linecap="round", stroke-linejoin="round", stroke-width="2", d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z")
              | Historial de Vales de Salida
           
          //- Divisor
          .border-t.border-gray-200.my-4
          
          //- Sección: Inventario
          .space-y-1
            .px-2.py-1.text-xs.font-semibold.text-gray-500.uppercase.tracking-wide
              | Inventario
            
            a.sidebar-link(
              href="/inventario/oficialia"
              class="flex items-center px-3 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 hover:text-gray-900 transition duration-150 ease-in-out"
            )
              svg.h-5.w-5.mr-3.text-gray-400(fill="currentColor", viewBox="0 0 20 20")
                path(fill-rule="evenodd", d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4zm-2 5v5a2 2 0 002 2h12a2 2 0 002-2V9H2zm8 2a1 1 0 011 1v1.586l.293-.293a1 1 0 111.414 1.414l-2 2a1 1 0 01-1.414 0l-2-2a1 1 0 111.414-1.414L9 13.586V12a1 1 0 011-1z", clip-rule="evenodd")
              | Ver Inventario
              
            //- Divisor
            .border-t.border-gray-200.my-4
            
            //- Sección: Acciones de Inventario (activa)
            .space-y-1
              .px-2.py-1.text-xs.font-semibold.text-gray-500.uppercase.tracking-wide
                | Acciones de Inventario
              
              a.sidebar-link(
                href="/inventario/oficialia/acciones"
                class="flex items-center px-3 py-2 text-sm font-medium text-emerald-700 bg-emerald-50 rounded-md"
              )
                svg.h-5.w-5.mr-3.text-emerald-500(fill="currentColor", viewBox="0 0 20 20")
                  path(fill-rule="evenodd", d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z", clip-rule="evenodd")
                | Gestionar Inventario
              
              a.sidebar-link(
                href="/inventario/oficialia/acciones/productos-criticos"
                class="flex items-center px-3 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 hover:text-gray-900 transition duration-150 ease-in-out"
              )
                svg.h-5.w-5.mr-3.text-red-400(fill="currentColor", viewBox="0 0 20 20")
                  path(fill-rule="evenodd", d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z", clip-rule="evenodd")
                | Existencias Negativas

        //- Footer del sidebar
        .px-4.py-4.border-t.border-gray-200.bg-gray-50
          .flex.items-center.justify-between.text-xs.text-gray-500
            span Sistema de Almacén
            span v1.0

    //- Contenido principal
    div(class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6")
      
      //- Estadísticas del inventario (simplificadas para oficialía)
      .bg-white.rounded-lg.shadow.p-6.mb-6
        h2.text-lg.font-semibold.text-gray-900.mb-4 Resumen del Inventario
        
        .grid.grid-cols-2.md-grid-cols-3.gap-4
          .bg-blue-50.p-4.rounded-lg
            .flex.items-center
              svg.h-8.w-8.text-blue-600.mr-3(fill="currentColor", viewBox="0 0 20 20")
                path(fill-rule="evenodd", d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z", clip-rule="evenodd")
              .flex-1
                .text-2xl.font-bold.text-blue-900= estadisticas.total_productos
                .text-sm.text-blue-600 Total de productos
          

          
          .bg-red-50.p-4.rounded-lg
            .flex.items-center
              svg.h-8.w-8.text-red-600.mr-3(fill="currentColor", viewBox="0 0 20 20")
                path(fill-rule="evenodd", d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z", clip-rule="evenodd")
              .flex-1
                .text-2xl.font-bold.text-red-900= estadisticas.productos_negativos
                .text-sm.text-red-600 Existencias negativas

      //- Acciones principales (simplificadas para oficialía)
      .bg-white.rounded-lg.shadow.p-6.mb-6
        h2.text-lg.font-semibold.text-gray-900.mb-4 Acciones Disponibles
        
        .grid.grid-cols-1.md-grid-cols-2.lg-grid-cols-3.gap-4
          
          //- Ver productos con existencias negativas
          a(
            href="/inventario/oficialia/acciones/productos-criticos"
            class="bg-red-50 hover:bg-red-100 border-2 border-red-200 hover:border-red-300 rounded-lg p-6 transition duration-150 ease-in-out group"
          )
            .flex.items-center.mb-3
              svg.h-8.w-8.text-red-600.mr-3(fill="currentColor", viewBox="0 0 20 20")
                path(fill-rule="evenodd", d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z", clip-rule="evenodd")
              h3(class="text-lg font-medium text-red-900 group-hover:text-red-800") Existencias Negativas
            p.text-sm.text-red-700.mb-3 Ver productos con existencias negativas que requieren corrección inmediata
            div(class="flex items-center text-red-600 group-hover:text-red-700")
              span.text-sm.font-medium Ver #{estadisticas.productos_negativos} productos
              svg(class="h-4 w-4 ml-2 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                path(stroke-linecap="round", stroke-linejoin="round", stroke-width="2", d="M9 5l7 7-7 7")


        //- Auditoría de inventario
          a(
            href="/inventario/oficialia/acciones/auditoria"
            class="bg-indigo-50 hover:bg-indigo-100 border-2 border-indigo-200 hover:border-indigo-300 rounded-lg p-6 transition duration-150 ease-in-out group"
          )
            .flex.items-center.mb-3
              svg.h-8.w-8.text-indigo-600.mr-3(fill="currentColor", viewBox="0 0 20 20")
                path(fill-rule="evenodd", d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z", clip-rule="evenodd")
              h3(class="text-lg font-medium text-indigo-900 group-hover:text-indigo-800") Auditoría
            p.text-sm.text-indigo-700.mb-3 Realizar conteos físicos y verificación de existencias del inventario
            div(class="flex items-center text-indigo-600 group-hover:text-indigo-700")
              span.text-sm.font-medium Iniciar auditoría
              svg(class="h-4 w-4 ml-2 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                path(stroke-linecap="round", stroke-linejoin="round", stroke-width="2", d="M9 5l7 7-7 7")


          //- Configuración básica
          a(
            href="/inventario/oficialia/acciones/configuracion"
            class="bg-gray-50 hover:bg-gray-100 border-2 border-gray-200 hover:border-gray-300 rounded-lg p-6 transition duration-150 ease-in-out group"
          )
            .flex.items-center.mb-3
              svg.h-8.w-8.text-gray-600.mr-3(fill="currentColor", viewBox="0 0 20 20")
                path(fill-rule="evenodd", d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z", clip-rule="evenodd")
              h3(class="text-lg font-medium text-gray-900 group-hover:text-gray-800") Configuración
            p.text-sm.text-gray-700.mb-3 Ajustar configuraciones básicas del sistema
            div(class="flex items-center text-gray-600 group-hover:text-gray-700")
              span.text-sm.font-medium Ver opciones
              svg(class="h-4 w-4 ml-2 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                path(stroke-linecap="round", stroke-linejoin="round", stroke-width="2", d="M9 5l7 7-7 7")

      //- Alertas y notificaciones (simplificadas)
      if estadisticas.productos_negativos > 0
        .bg-red-50.border-l-4.border-red-400.p-4.rounded-lg.mb-6
          .flex
            .flex-shrink-0
              svg.h-5.w-5.text-red-400(fill="currentColor", viewBox="0 0 20 20")
                path(fill-rule="evenodd", d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z", clip-rule="evenodd")
            .ml-3
              h3.text-sm.font-medium.text-red-800 Atención Requerida
              .mt-2.text-sm.text-red-700
                p
                  strong #{estadisticas.productos_negativos} productos
                  |  tienen existencias negativas y requieren corrección inmediata.
              .mt-3
                a(
                  href="/inventario/oficialia/acciones/productos-criticos"
                  class="text-red-800 font-medium underline hover:text-red-900"
                )
                  | Ver productos que requieren corrección →

  //- Script específico para acciones de inventario
  script.
    document.addEventListener('DOMContentLoaded', function() {
      // Funcionalidad del sidebar
      const sidebar = document.getElementById('sidebar');
      const sidebarToggle = document.getElementById('sidebarToggle');
      const sidebarOverlay = document.getElementById('sidebarOverlay');
      const closeSidebar = document.getElementById('closeSidebar');

      let sidebarOpen = false;

      function openSidebar() {
        sidebarOpen = true;
        sidebar.classList.remove('-translate-x-full');
        sidebar.classList.add('translate-x-0');
        sidebarOverlay.classList.remove('hidden');
        
        const icon = sidebarToggle.querySelector('svg');
        icon.style.transform = 'rotate(90deg)';
        icon.style.transition = 'transform 0.3s ease-in-out';
        
        if (window.innerWidth < 1024) {
          document.body.style.overflow = 'hidden';
        }
      }

      function closeSidebarFunc() {
        sidebarOpen = false;
        sidebar.classList.add('-translate-x-full');
        sidebar.classList.remove('translate-x-0');
        sidebarOverlay.classList.add('hidden');
        
        const icon = sidebarToggle.querySelector('svg');
        icon.style.transform = 'rotate(0deg)';
        
        document.body.style.overflow = '';
      }

      if (sidebarToggle) {
        sidebarToggle.addEventListener('click', function() {
          if (sidebarOpen) {
            closeSidebarFunc();
          } else {
            openSidebar();
          }
        });
      }

      if (closeSidebar) {
        closeSidebar.addEventListener('click', closeSidebarFunc);
      }

      if (sidebarOverlay) {
        sidebarOverlay.addEventListener('click', closeSidebarFunc);
      }

      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && sidebarOpen) {
          closeSidebarFunc();
        }
      });

      window.addEventListener('resize', function() {
        if (window.innerWidth >= 1024) {
          document.body.style.overflow = '';
          sidebarOverlay.classList.add('hidden');
          sidebar.classList.remove('-translate-x-full');
          sidebar.classList.add('translate-x-0');
        } else if (sidebarOpen) {
          document.body.style.overflow = 'hidden';
        }
      });

      // Actualizar estadísticas cada 30 segundos
      setInterval(function() {
        fetch('/inventario/oficialia/acciones/api/estadisticas?sistema=OFICIALIA')
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              // Actualizar los contadores en tiempo real
              const estadisticas = data.estadisticas;
              console.log('Estadísticas actualizadas:', estadisticas);
            }
          })
          .catch(error => {
            console.error('Error al actualizar estadísticas:', error);
          });
      }, 30000);
    });
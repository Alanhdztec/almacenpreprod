//- ========================================
//- VIEWS/EXIT-TICKET/GENERAL/DETAIL.PUG - DETALLE VALE DE SALIDA ALMACÉN GENERAL
//- ========================================

extends ../../layouts/main

block content
  .min-h-screen.bg-gray-50
    //- Header
    header.bg-white.shadow-sm
      div(class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8")
        .flex.justify-between.items-center.py-6
          .flex.items-center.space-x-4
            a(href="/exit-ticket/general/history" class="text-pink-600 hover:text-pink-800 transition-colors")
              svg.h-6.w-6(fill="none" stroke="currentColor" viewBox="0 0 24 24")
                path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18")
            
            div
              h1.text-2xl.font-bold.text-gray-900 Vale de Salida ##{vale.id_vale_de_salida}
              .text-sm.text-gray-600 Almacén General

    div(class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6")
      //- Grid principal reorganizado: Área, Info General, Sistema, Empleados
      div(class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6")

        //- 1. Información del área destino
        .bg-white.rounded-lg.shadow-sm.overflow-hidden
          .bg-pink-700.px-4.py-3
            h3.text-base.font-medium.text-white.flex.items-center
              | Área Destino

          .p-4
            if vale.area_descripcion
              .space-y-3
                div
                  .text-xs.font-medium.text-gray-500.uppercase.tracking-wide Área
                  .text-sm.font-bold.text-gray-900= vale.area_descripcion
                
                if vale.clave_area && vale.clave_subarea
                  div
                    .text-xs.font-medium.text-gray-500.uppercase.tracking-wide Clave
                    .text-sm.font-mono.font-bold.text-gray-900= `${vale.clave_area}.${vale.clave_subarea}`
                
                if vale.estructura_administrativa
                  div
                    .text-xs.font-medium.text-gray-500.uppercase.tracking-wide Estructura Administrativa
                    .text-xs.font-bold.text-gray-900= vale.estructura_administrativa
            else
              .text-center.py-4
                svg.mx-auto.h-8.w-8.text-gray-300.mb-2(fill="none" stroke="currentColor" viewBox="0 0 24 24")
                  path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4")
                .text-xs.text-gray-500 Sin información de área

        //- 2. Información general
        .bg-white.rounded-lg.shadow-sm.overflow-hidden
          .bg-pink-700.px-4.py-3
            h3.text-base.font-medium.text-white.flex.items-center
              | Información General

          .p-4.space-y-3
            div
              .text-xs.font-medium.text-gray-500.uppercase.tracking-wide Fecha de Salida
              .text-sm.font-bold.text-gray-900= new Date(vale.fecha_de_salida).toLocaleDateString('es-MX', { year: 'numeric', month: 'long', day: 'numeric' })
            
            div
              .text-xs.font-medium.text-gray-500.uppercase.tracking-wide Número de Factura
              .text-sm.font-bold.text-gray-900= vale.numero_de_factura || 'Sin número'
            
            div
              .text-xs.font-medium.text-gray-500.uppercase.tracking-wide Requisición
              .text-sm.font-bold.text-gray-900= vale.requisicion_de_salida || 'N/A'

        //- 3. Sistema
        .bg-white.rounded-lg.shadow-sm.overflow-hidden
          .bg-pink-700.px-4.py-3
            h3.text-base.font-medium.text-white.flex.items-center
              | Sistema

          .p-4.space-y-3
            div
              .text-xs.font-medium.text-gray-500.uppercase.tracking-wide Estatus
              span.inline-flex.items-center.px-2.py-1.rounded.text-xs.font-bold.bg-gray-100.text-gray-900= vale.estatus_de_captura || 'N/A'
            
            div
              .text-xs.font-medium.text-gray-500.uppercase.tracking-wide Estado
              if vale.esta_concluida
                span.inline-flex.items-center.px-2.py-1.rounded.text-xs.font-bold.bg-green-100.text-green-800 Concluido
              else
                span.inline-flex.items-center.px-2.py-1.rounded.text-xs.font-bold.text-black-800 Pendiente
            
            div
              .text-xs.font-medium.text-gray-500.uppercase.tracking-wide Tipo de Almacén
              .text-sm.font-bold.text-gray-900= vale.tipo_almacen

        //- 4. Empleados
        .bg-white.rounded-lg.shadow-sm.overflow-hidden
          .bg-pink-700.px-4.py-3
            h3.text-base.font-medium.text-white.flex.items-center
              | Empleados

          .p-4.space-y-3
            div
              .text-xs.font-medium.text-gray-500.uppercase.tracking-wide Entrega
              .text-sm.font-bold.text-gray-900= vale.empleado_entrega_completo || 'No especificado'

            
            if vale.empleado_recibe_completo
              div
                .text-xs.font-medium.text-gray-500.uppercase.tracking-wide Recibe
                .text-sm.font-bold.text-gray-900= vale.empleado_recibe_completo

            else
              div
                .text-xs.font-medium.text-gray-500.uppercase.tracking-wide Recibe
                .text-sm.text-gray-500.italic No especificado

      //- Observaciones (si existen)
      if vale.observaciones
        .bg-white.rounded-lg.shadow-sm.overflow-hidden.mb-6
          .bg-pink-700.px-4.py-3
            h3.text-base.font-medium.text-white.flex.items-center
              | Observaciones
          .p-4
            .text-sm.text-gray-700= vale.observaciones

      //- Detalle de productos
      .bg-white.rounded-lg.shadow-sm.overflow-hidden
        .bg-pink-700.px-4.py-3
          h3.text-base.font-medium.text-white.flex.items-center
            | Detalle de Productos

        .overflow-x-auto
          table.min-w-full.divide-y.divide-gray-200
            thead.bg-gray-50
              tr
                th.px-4.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase.tracking-wider #
                th.px-4.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase.tracking-wider Producto
                th.px-4.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase.tracking-wider Código
                th.px-4.py-3.text-center.text-xs.font-medium.text-gray-500.uppercase.tracking-wider Cantidad
                th.px-4.py-3.text-center.text-xs.font-medium.text-gray-500.uppercase.tracking-wider Unidad
                th.px-4.py-3.text-center.text-xs.font-medium.text-gray-500.uppercase.tracking-wider Merma
                th.px-4.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase.tracking-wider Nota

            tbody.bg-white.divide-y.divide-gray-200
              if detalle && detalle.length > 0
                each producto, index in detalle
                  tr(class="hover:bg-gray-50 transition-colors")
                    td.px-4.py-3.whitespace-nowrap.text-sm.font-medium.text-gray-900.text-center= index + 1
                    td.px-4.py-3.whitespace-nowrap.text-sm.text-gray-900= producto.producto_generico
                    td.px-4.py-3.whitespace-nowrap
                      span.inline-flex.items-center.px-2.py-1.rounded.text-xs.font-medium.bg-gray-100.text-gray-800= producto.codigo
                    td.px-4.py-3.whitespace-nowrap.text-sm.text-gray-900.text-center= parseFloat(producto.cantidad).toLocaleString('es-MX')
                    td.px-4.py-3.whitespace-nowrap.text-sm.text-gray-900.text-center= producto.abreviatura
                    td.px-4.py-3.whitespace-nowrap.text-center
                      if producto.es_merma
                        span.inline-flex.items-center.px-2.py-1.rounded.text-xs.font-medium.bg-red-100.text-red-800 Sí
                      else
                        span.inline-flex.items-center.px-2.py-1.rounded.text-xs.font-medium.bg-green-100.text-green-800 No
                    td.px-4.py-3.text-sm.text-gray-700
                      if producto.nota
                        = producto.nota
                      else
                        span.text-gray-400.text-xs Sin nota
              else
                tr
                  td.px-4.py-8.text-center.text-gray-500(colspan="7")
                    svg.mx-auto.h-8.w-8.text-gray-300.mb-2(fill="none" stroke="currentColor" viewBox="0 0 24 24")
                      path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4")
                    .text-sm.font-medium.text-gray-900 No hay productos registrados
                    .text-xs.text-gray-500 Este vale no tiene productos asociados.

block styles
  style.
    @media print {
      .print\\:hidden {
        display: none !important;
      }
      .shadow-sm {
        box-shadow: none !important;
      }
      .bg-gray-800 {
        background: #374151 !important;
        color: white !important;
      }
      body {
        font-size: 12px;
      }
      .rounded-lg {
        border-radius: 0 !important;
      }
    }